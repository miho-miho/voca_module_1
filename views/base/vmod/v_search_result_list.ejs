<!doctype html><!-- vmod_detail0 : 分類表の詳細ページ -->
<html lang="jp">
  <head><%- include('../partials/v_head') %></head>
  <body>
  <header><%- include('../partials/header') %></header>
    <main class="container main">
      <div class="row">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
          <ol class="breadcrumb bg-secondary top-bread">
            <li class="breadcrumb-item"><a href="/voca/" class="first-item">東外大言語モジュール top(Node版)</a></li>
            <li class="breadcrumb-item active"><a href="/voca/<%- lg %>/v/"><%= lang_jp %></a></li>
            <li class="breadcrumb-item active">語彙モジュール</li>
          </ol>
        </nav>
        <%- include('../partials/v_sidebar') %>
        <div class="col main-body">
          <div class="card">
            <div class="card-header">
              <h4 class="card-title">語彙リスト</h4>
            </div>
          </div>
          <div class="row">
            <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
              <ol class="breadcrumb bg-secondary">
                <li class="breadcrumb-item active" aria-current="page"><a href="./v_search" class="first-item">検索</a></li>
                <li class="breadcrumb-item active"><a href="" id="search-link"><span id="search-type"></span>：<%= targetChar %></a></li>
              </ol>
            </nav>
            <div class="row">
              <h5 class="col-6">　id　語彙</h5>
              <h5 class="col-6">取得件数：<span class="c_cand"></span>件</h5>
            </div>
            <div class="result-area container">
              <div class="list-group result-list list-group-flush flex-column d-flex flex-wrap">
              </div>
            </div><!-- result-area -->
          </div>
        </div>
      </div>
    </main>
    <div class="push"></div>
    <footer><%- include('../partials/footer') %></footer>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script type="text/javascript">
      var search_result_list = <%- JSON.stringify(search_result_list) %>;
      var targetChar = "<%= targetChar %>"
      if (targetChar.includes("~")) {
        $("#search-type").text("単語検索")
        var char = targetChar.replace(/~/g, "")
        $("#search-link").attr("href", `./v_search_list-str=${char}&st=<%= targetSt %>`)
      } else {
        $("#search-type").text("文字検索")
        $("#search-link").attr("href", "./v_search_list-char=<%= targetChar %>")
      }
      $(".c_cand").text(search_result_list.length)
      var i = 1;
      var targetWordIds = []
      for (var item of search_result_list) {
        var s_list = [];
        var sense = ""
        if (item.senses.length > 2) {
          s_list = item.senses.slice(0, 2);
          s_list.push("...")
        } else if (1 <= item.senses.length <= 2){
          s_list = item.senses
        } else {
          s_list = []
        }
        if (s_list.length > 0) {
          sense = `(${s_list})`
        }
        $(".result-list").append('<button type="button" data-href="" class="list-group-item list-group-item-action"><span class="id">'+i+'.</span><span class="midasi_go" id='+item.id+'>'+item.midasi+'</span>'+sense+'</button>')
        targetWordIds.push(item.id)
        i+=1;
      }
      jQuery(function($){
        $('button[data-href]').addClass('clickable')
        .click(function(e) {
          if(!$(e.target).is('a')){
            var targetWord = "";
            if ($(e.target).html().includes("span")) {
              targetWord = ($(e.target).find('.midasi_go').text());
            } else {
              targetWord = ($(e.target).html());
            }
            var url = "./s_search_detail-tg=<%= targetChar %>";
            var targetSt = "<%= targetSt %>"
            var targetData = `<input type="hidden" name="targetWordIds" value="${targetWordIds}"/><input type="hidden" name="targetWord" value="${targetWord}"/><input type="hidden" name="targetSt" value="${targetSt}"/>`
            $("body").append('<form action="'+url+'" method="post" id="post">'+targetData+'</form>');
            alert(targetData);
            $("#post").submit();
          };
        });
      });
      let windowWidth = $(window).width()
      if (windowWidth < 767) {
        $(function(){
          $("#v_sidebar").before($(".main-body"));
        });
      }
      window.onpageshow = function(event) {
        if (event.persisted) {
          window.location.reload();
        }
      };
    </script>
    <style>
      .id, .c_cand{
        padding-right: 10px;
      }
      .result-list button {
        max-width: 250px;
      }
      @media screen and (min-width: 1200px) {
        .sidebar {
          height: 100vh;
        }
        .result-list {
          height: 90%;
        }
      }
    </style>
  </body>
</html>
