<!doctype html>
<html lang="jp">
  <head>
    <% const ROOT = `${process.cwd()}`; %>
    <%- include(`${ROOT}/views/partials/head`) %>
  </head>
  <body>
    <%- include(`${ROOT}/views/partials/header`); %>
    <main class="container">
      <div class="row">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
          <ol class="breadcrumb bg-secondary">
            <li class="breadcrumb-item"><a href="/polish" class="first-item">ポーランド語</a></li>
            <li class="breadcrumb-item active">語彙モジュール</li>
            <li class="breadcrumb-item active" aria-current="page"><a href="/smod">例文検索</a></li>
          </ol>
        </nav>
        <%- include(`${ROOT}/views/partials/sidebar`); %>
        <div class="col">
            <h1>例文検索</h1>
            <div class="explain">
              <ol>
                <li>検索したい言語をタブで選択する</li>
                <li>検索バーに検索したい単語を入力する<span>　　＊候補が表示されるので選択してください</span></li>
                <li>「検索」をクリックする</li>
              </ol>
              <p>・結果は「日本語」「トークン化(日)」「ポーランド語」「トークン化(ポ)」の順に表示されます</p>
              <p>・日本語とポーランド語の表示・非表示をボタンで切り替えることができます</p>
              <p><strong>＊次の文を検索する時は必ず「リセット」をクリックしてください</strong></p>
            </div>
            <div class="tab_box">
  	           <div class="btn_area">
                 <button type="button" class="btn tab_btn active" id="jp-tab">日本語（japoński）</button>
                 <button type="button" class="btn tab_btn" id="pl-tab">ポーランド語（polski）</button>
                 <button type="button" class="btn tab_btn nondisplay" id="prep-tab">前置詞＋共起格</button>
               </div>
               <div class="panel_area container" id="tab-area">
                 <div class="tab_panel active">
                   <p>日本語で入力してください（Proszę wpisać po japońsku）</p>
                   <div class="row">
                     <div class="col-7">
                        <input type="text" class="form-control" id="keyword_jp">
                      </div>
                      <div class="col-3">
                        <button class="btn btn-outline-primary" id="search-btn-jp">検索</button>
                      </div>
                   </div>
                 </div>
                 <div class="tab_panel">
                   <p>Proszę wpisać po polsku（ポーランド語で入力してください）</p>
                   <div class="row">
                     <div class="col-7">
                        <input type="text" class="form-control" id="keyword">
                      </div>
                      <div class="col-3">
                        <button class="btn btn-outline-primary" id="search-btn">Szukaj</button>
                      </div>
                   </div>
                 </div>
                 <div class="tab_panel" id="defo-panel">
                   <p>前置詞と共起する格の組み合わせを選択してください</p>
                   <div class="row">
                     <div class="col-7">
                       <select class="form-select" aria-label="Default select example" id="prep-selecter">
                         <option hidden selected value="none">選択してください</option>
                       </select>
                      </div>
                   </div>
                 </div>
               </div>
             </div>
             <div class="search-result-area container">
               <div class="row">
                 <div class="col">
                   <h4>検索結果：<span id="howmany-cand">0</span>件</h4>
                 </div>
                 <div class="col float-end">
                   <button class="btn btn-outline-primary" id="reset-btn">リセット</button>
                 </div>
                 <div class="container">
                   <div class="form-check form-switch form-check-inline float-end">
                     <input type="checkbox" class="form-check-input" name="inlineRadioOptions" role="switch" value="option1" id="open-pl" checked>
                     <label for="inlineRadio1" class="form-check-label">ポーランド語</label>
                   </div>
                   <div class="form-check form-switch form-check-inline float-end">
                     <input type="checkbox" class="form-check-input" name="inlineRadioOptions" role="switch" value="option2" id="open-jpn" checked>
                     <label for="inlineRadio2" class="form-check-label">日本語</label>
                   </div>
                   <div class="result-table container row">
                     <div class="card col" id="result">
                       <ul class="list-group list-group-flush">
                       </ul>
                     </div>
                   </div>
                 </div>
               </div>
             </div>
           </div>
         </div>
      </main>
      <footer><%- include(`${ROOT}/views/partials/footer`); %></footer>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
      //タブ作成
      $('.tab_box .tab_btn').click(function() {
        var index = $('.tab_box .tab_btn').index(this);
        $('.tab_box .tab_btn, .tab_box .tab_panel').removeClass('active');
        $(this).addClass('active');
        $('.tab_box .tab_panel').eq(index).addClass('active');
      });
      //データ読み込み
      var sentences = <%- JSON.stringify(sentences) %>;
      var morp_list = <%- JSON.stringify(morp_list) %>;
      var morp_set = <%- JSON.stringify(morp_set) %>;
      var japanese = <%- JSON.stringify(japanese) %>;
      var jp_morp_list = <%- JSON.stringify(jp_morp_list) %>;
      var jp_morp_set = <%- JSON.stringify(jp_morp_set) %>;
      var targetIndexes = [];
      //オートコンプリート_polish
      $(function() {
        $("#keyword").autocomplete({
          source: function(request, response) {
            var list = [];
            list = morp_set.filter(function (word) {
              return word.indexOf(request.term) === 0 || word.toLowerCase().indexOf(request.term) === 0;
            });
            response(list);
          },
        });
      });
      //オートコンプリート_jpn
      $(function() {
        $("#keyword_jp").autocomplete({
          source: function(request, response) {
            var list = [];
            list = jp_morp_set.filter(function (word) {
              return word.indexOf(request.term) === 0 || word.toLowerCase().indexOf(request.term) === 0;
            });
            response(list);
          },
        });
      });
      //検索ボタン挙動
      function searchResult(ky, list){
        var targetWord = $(ky).val();
        list.forEach((item, i) => {
          if(item.includes(targetWord)){
            targetIndexes.push(i)
          }
        });
      }
      function clickSearchBtn(){
        if (targetIndexes.length === 0) {
          swal({
            text: "検索する単語を入力してください"
　         });
        }
        $.each(targetIndexes, function(){
          $("#result").append('<li class="list-group-item" id='+this+"></li>")
          var id = "#"+this;
          $(id).append('<p class="t_jpn">'+japanese[this]+"<p>")
          //jpn = jp_morp_list[this].join(" / ");
          //$(id).append('<p>'+jpn+"</p>");
          pl = sentences[this].join(" ");
          $(id).append('<p class="t_pl">'+pl+"</p>")
          //pl_m = morp_list[this].join(" / ");
          //$(id).append('<p> '+pl_m+" </p>");
        });
        $("#howmany-cand").text(targetIndexes.length)
        if ($("#howmany-cand").text() === "0") {
          ;
        }else {
          $(function(){
            $('#result').paginathing({
              perPage: 10, // show item per page
              limitPagination: false, // false or number. Limiting your pagination number.
              prevNext: true, // enable previous and next button
              firstLast: true, // enable first and last button
              prevText: '&laquo;', // Previous button text
              nextText: '&raquo;', // Next button text
              firstText: 'First', // "First button" text
              lastText: 'Last', // "Last button" text
              activeClass: 'act',
            });
          });
        }
      }
      //デフォルトを日本語設定にする（activeの拾い方）
      $("#search-btn-jp").click(function(){
        searchResult(keyword_jp, jp_morp_list)
        if ($("#howmany-cand").text() === "0") {
          clickSearchBtn();
        } else{
          ;
        }
      });
      $(".btn_area").find("button").click(function(){
        if($("#pl-tab").attr("class") === "btn tab_btn active"){
          $("#search-btn").click(function(){
            searchResult(keyword, morp_list)
            if ($("#howmany-cand").text() === "0") {
              clickSearchBtn();
            } else{
              ;
            }
          });
        }
      });
      //リセットボタン
      $(function (){
        $("#reset-btn").on("click", function(){
          clearFrom();
        });
        function clearFrom() {
          $(".pagination-container").remove();
          $("#keyword").val("");
          $("#keyword_jp").val("");
          $("#result").empty();
          $("#howmany-cand").text("0");
          $('#prep-selecter').val("none");
          targetIndexes = []
        }
      });
      //表示切り替え
      $("#open-jpn").change(function() {
        if ($(this).prop("checked") == false) {
          $(".t_jpn").css("visibility", "hidden");
        } else {
          $(".t_jpn").css("visibility", "visible");
        }
      });
      $("#open-pl").click(function() {
        if ($(this).prop("checked") == false) {
          $(".t_pl").css("visibility", "hidden");
        } else {
          $(".t_pl").css("visibility", "visible");
        }
      });
    </script>
  </body>
</html>
