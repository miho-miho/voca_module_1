<!doctype html>
<html lang="jp">
  <head>
    <% const ROOT = `${process.cwd()}`; %>
    <%- include(`${ROOT}/views/partials/head`) %>
  </head>
  <body>
    <%- include(`${ROOT}/views/partials/header`); %>
    <main class="container">
      <div class="row">
        <nav style="--bs-breadcrumb-divider: '>';" aria-label="breadcrumb">
          <ol class="breadcrumb bg-secondary">
            <li class="breadcrumb-item"><a href="/polish" class="first-item">ポーランド語</a></li>
            <li class="breadcrumb-item active">語彙モジュール</li>
            <li class="breadcrumb-item active" aria-current="page"><a href="/vmod_table">基礎語彙分類表</a></li>
          </ol>
        </nav>
        <%- include(`${ROOT}/views/partials/sidebar`); %>
        <div class="col">
          <h1>基礎語彙分類表</h1>
          <div class="row">
            <div class="container">
              <div class="form-check form-switch form-check-inline float-end">
                <input type="checkbox" class="form-check-input" name="inlineRadioOptions" role="switch" value="option2" id="open-jpn" checked>
                <label for="inlineRadio2" class="form-check-label">日本語</label>
              </div>
              <div class="form-check form-switch form-check-inline float-end">
                <input type="checkbox" class="form-check-input" name="inlineRadioOptions" role="switch" value="option1" id="open-pl" checked>
                <label for="inlineRadio1" class="form-check-label">ポーランド語</label>
              </div>
            </div>
            <div class="voca_area1 col">
              <div class="vocaBox card">
                <div class="card-header bg-secondary" style="color:white;">
                  <img src="images/bookicon.png"  class="d-inline-block align-text-top" width="29" height="27">
                  <span class="align-middle">体の類</span>
                </div>
              </div>
              <div class="resultArea1">
              </div>
            </div>
            <div class="voca_area2 col">
              <div class="vocaBox card">
                <div class="card-header bg-secondary" style="color:white;">
                  <img src="images/bookicon.png"  class="d-inline-block align-text-top" width="29" height="28">
                  <span class="align-middle">意味分類による学習</span>
                </div>
              </div>
              <div class="resultArea2">
              </div>
            </div>
          </div>
        </div>
      </div>
    </main>
    <%- include(`${ROOT}/views/partials/footer`); %>
    <!-- Option 1: Bootstrap Bundle with Popper -->
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.0.2/dist/js/bootstrap.bundle.min.js" integrity="sha384-MrcW6ZMFYlzcLA8Nl+NtUVF0sA7MsXsP1UyJoMp4YLEuNSfAP+JcXn/tWtIaxVXM" crossorigin="anonymous"></script>
    <script>
      var data = <%- JSON.stringify(data) %>;
      var all = <%- JSON.stringify(all) %>;
      var category = <%- JSON.stringify(category) %>;
      var word_obj = <%- JSON.stringify(word_obj) %>;
      console.log(word_obj);
      //box作成
      category.forEach((item) => {
        $(".resultArea1").append('<div class="vocaBox card" id='+item+'></div>')
        var id = "#"+item
        $(id).append('<div class="card-header">'+item+'</div>')
        $(id).append('<div class="card-body"><table class="table table-hover"><tbody></tobdy<table></div>')
      });
      //中身作成
      var word_list = Object.entries(data)
      var contents;
      word_list.forEach((item) => {
        var id = "#"+item[0]
        item[1].forEach((e, i) => {
          $(id).children(".card-body").find("tbody").append('<tr class="pl" data-href="/vmod_detail" id='+item[0]+"_"+i+'><td class="t_pl">'+e[4][0]+'</td><td class="t_jpn">'+e[4][1]+'</td></tr>')
        });
      });
      category.forEach((item, i) => {
        var cs = "#"+item
        $(cs).children(".card-header").click(function(){
          $(cs).children(".card-body").slideToggle();
        });
      });
      jQuery(function($){
        $('tr[data-href]').addClass('clickable')
        .click(function(e) {
          if(!$(e.target).is('a')){
            var targetUrl = ($(e.target).parents('.card').attr("id"))
            var targetPl = ($(e.target).closest('tr').find(".t_pl").text())
            var targetJp = ($(e.target).closest('tr').find(".t_jpn").text())
            var url = $(e.target).closest('tr').data('href')
            console.log(url)
            var targetData = '<input type="hidden" name="category" value="' + targetUrl + '" /><input type="hidden" name="pl_word" value="' + targetPl + '" />'
            //var target_pl = '<input type="hidden" name="pl_word" value="' + $(e.target).closest('td').text() + '" />'
            $("body").append('<form action="'+url+'" method="post" id="post">'+targetData+'</form>');
            $("#post").submit();
          };
        });
      });
      window.onload = function(){
        var hash = decodeURI(location.hash.substring(1));
        if (hash.length === 0) {
          ;
        } else{
          $("#"+hash).children(".card-body").slideToggle();
        }
      }
    </script>
    <style>
      tr {
        cursor:pointer;
      }
      .card-body {
        overflow-x: hidden;
        overflow-y: scroll;
        height:fit-content;
        max-height: 300px;
      }
    </style>
  </body>
</html>
